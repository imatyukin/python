Документация по работе скрипта для сбора статистики SAP на Nokia 7750 SR

Оглавление

1. Назначение скрипта
2. Как работает скрипт
3. Требования к окружению
4. Настройка конфигурации
5. Запуск скрипта
6. Примеры использования
7. Интерпретация результатов
8. Возможные ошибки и их решение

1. Назначение скрипта

Скрипт предназначен для автоматизации сбора статистики по SAP (Service Access Points) на маршрутизаторах Nokia 7750 SR.
Он позволяет:
- Получить список SAP для указанного lag или сервиса и lag.
- Собрать статистику по передаче данных (октеты, скорость) для каждого SAP.

2. Как работает скрипт

Основные шаги:

1. Подключение к устройству:
Скрипт подключается к маршрутизатору по SSH с использованием параметров из конфигурационного файла.
2. Получение списка SAP:
Выполняется команда 'show service sap-using' для получения списка всех SAP или 'show service id <service_id> sap'
для получения списка всех SAP, связанных с указанным сервисом.
3. Фильтрация SAP:
Скрипт фильтрует SAP по указанному интерфейсу (например, lag-11), чтобы собирать статистику только для нужных SAP.
4. Сбор статистики:
Для каждого отфильтрованного SAP выполняется команда:
'monitor service id <service_id> sap <sap> rate interval 11 repeat 1'.
Скрипт извлекает данные о передаче октетов и рассчитывает скорость в Мбит/с или Кбит/с.
Данные извлекаются после появления строки "At time t = 11 sec (Mode: Rate)" для Egress Aggregate Forwarded.
5. Вывод результатов:
Скрипт выводит статистику по каждому SAP, включая:
- Количество октетов за 11 секунд.
- Скорость передачи данных (Мбит/с и Кбит/с).
- Топ-10 самых крупных клиентов.

3. Требования к окружению

Необходимое ПО:
- Python 3.8 или выше.

Установленные библиотеки:
- netmiko (для подключения к устройству по SSH).
- yaml (для чтения конфигурационного файла).
- argparse (для обработки аргументов командной строки).

Устройство:
- Маршрутизатор Nokia 7750 SR.

4. Настройка конфигурации

Конфигурационный файл (config.yaml):
Файл config.yaml содержит параметры подключения к устройству и настройки скрипта.

5. Запуск скрипта

- Основной режим:
Для сбора статистики по всем SAP, связанным с указанным интерфейсом, выполните команду:
python3 sap_monitor_stats.py

- Тестовый режим:
Для сбора статистики по SAP в конкретном сервисе (например, 318608115), выполните команду:
python3 run_test.py

6. Примеры использования

Пример 1: Основной режим
python3 sap_monitor_stats.py
Скрипт соберёт статистику по всем SAP, связанным с интерфейсом lag-11.

Пример 2: Тестовый режим
python3 run_test.py
Скрипт соберёт статистику по SAP в сервисе 318608115, связанным с интерфейсом lag-11.

7. Интерпретация результатов

Пример вывода основного режима:

/*
Попытка подключения к устройству с IP: 192.168.233.135...
Вводимая команда: show system information | match Name
Подключение успешно установлено. Hostname устройства: 86-SRGT01-DR1
Вводимая команда: environment no more
Вводимая команда: environment time-stamp
Вводимая команда: show service sap-using
Найдено 2 SAP, относящихся к lag-47: {'lag-47:613.1765': '318608115', 'lag-47:614.1832': '418608115'}
[1/2] Сбор статистики для SAP: lag-47:613.1765 (Service ID: 318608115)
Вводимая команда: monitor service id 318608115 sap lag-47:613.1765 rate interval 11 repeat 1
[1/2] SAP lag-47:613.1765: Октеты за 11 сек = 624295, Egress Rate = 454.03 Кбит/с
[2/2] Сбор статистики для SAP: lag-47:614.1832 (Service ID: 418608115)
Вводимая команда: monitor service id 418608115 sap lag-47:614.1832 rate interval 11 repeat 1
[2/2] SAP lag-47:614.1832: Октеты за 11 сек = 432366, Egress Rate = 314.45 Кбит/с

Топ-10 самых крупных клиентов:
1. SAP lag-47:613.1765: Октеты за 11 сек = 624295, Egress Rate = 454.03 Кбит/с
2. SAP lag-47:614.1832: Октеты за 11 сек = 432366, Egress Rate = 314.45 Кбит/с
Соединение закрыто.
*/

Пример вывода тестового режима:

/*
Запуск основного скрипта с service_id = 318608115...
Попытка подключения к устройству с IP: 192.168.233.134...
Вводимая команда: show system information | match Name
Подключение успешно установлено. Hostname устройства: SRGT-BPE1
Вводимая команда: environment no more
Вводимая команда: environment time-stamp

Тестирование SAP в сервисе 318608115...
Вводимая команда: show service id 318608115 sap
Найдено 2 SAP, относящихся к lag-11 в сервисе 318608115: ['lag-11:613.1765', 'lag-11:614.1832']
[1/2] Сбор статистики для SAP: lag-11:613.1765 (Service ID: 318608115)
Вводимая команда: monitor service id 318608115 sap lag-11:613.1765 rate interval 11 repeat 1
[1/2] SAP lag-11:613.1765: Октеты за 11 сек = 853088, Egress Rate = 620.43 Кбит/с
[2/2] Сбор статистики для SAP: lag-11:614.1832 (Service ID: 318608115)
Вводимая команда: monitor service id 318608115 sap lag-11:614.1832 rate interval 11 repeat 1
[2/2] SAP lag-11:614.1832: Октеты за 11 сек = 854627, Egress Rate = 621.55 Кбит/с

Топ-10 самых крупных клиентов:
1. SAP lag-11:614.1832: Октеты за 11 сек = 854627, Egress Rate = 621.55 Кбит/с
2. SAP lag-11:613.1765: Октеты за 11 сек = 853088, Egress Rate = 620.43 Кбит/с
Соединение закрыто.
Скрипт успешно выполнен.
*/

8. Возможные ошибки и их решение

Ошибка 1: Не удалось подключиться к устройству
Причина: Неверные параметры подключения (IP, логин, пароль).
Решение: Проверьте конфигурационный файл (config.yaml).

Ошибка 2: SAP не найдены
Причина: В сервисе отсутствуют SAP, связанные с указанным интерфейсом.
Решение: Проверьте правильность указанного интерфейса и сервиса.

Ошибка 3: Некорректный вывод команды
Причина: Устройство вернуло неожиданный формат вывода.
Решение: Проверьте версию ПО на устройстве и обновите скрипт при необходимости.